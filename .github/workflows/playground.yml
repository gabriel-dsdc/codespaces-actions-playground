---
  name: Deploy on push
  on:
    push:
      branches: [main]
    pull_request:
      branches: [main]
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  jobs:
    lint-and-test:
      name: Lint and Test
      runs-on: ubuntu-latest
      steps:
        - name: Checkout Code
          uses: actions/checkout@main
          with:
            fetch-depth: 0
  
        - name: Setup Node.js
          uses: actions/setup-node@main
          with:
            node-version-file: "package.json"
  
    deploy:
      name: Build and Deploy
      runs-on: ubuntu-latest
      needs: lint-and-test
      if: github.ref == 'refs/heads/main'
      steps:
        - run: echo "${GIT_URL}"
          env:
            GIT_URL: https://git:@github.com/${GITHUB_REPOSITORY}.git
        - name: Build and Deploy with gh-pages
          run: |
            git remote set-url origin "${GIT_URL}"
          env:
            GIT_URL: https://git:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git
  